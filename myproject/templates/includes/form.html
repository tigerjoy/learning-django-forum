{% load form_tags widget_tweaks %}

{% if form.non_field_errors %}
    <div class="alert alert-danger" role="alert">
        {% for error in form.non_field_errors %}
            <p {% if forloop.last %} class="mb-0" {% endif %}>{{ error }}</p>
            {% if not forloop.last %}
                <hr>
            {% endif %}
        {% endfor %}
    </div>
{% endif %}

{% for field in form %}
    <div class="form-group">
        {{ field.label_tag }}
        {% comment %} 
        Pass the field to the input_class templatetag and let it
        decide what class to add when the field is 
        
        1) not bound (form is opened for the first time)
            CSS -> "form-control"
        2) bound and is valid (form has been submitted before)
            CSS -> "form-control is-valid"
        3) bound and is invalid (form has been submitted before)
            CSS -> "form-control is-invalid"

        field|input_class calls input_class(field) of the form_tags
        template tags.
        
        {% endcomment %}
        {% render_field field class=field|input_class %}
        {% comment %} 
        for each error in the field display them as invalid-feedback's
        {% endcomment %}
        {% for error in field.errors %}
            <div class="invalid-feedback">
                {{ error }}
            </div>
        {% endfor %}
        {% comment %} 
        Display the help text if the form is invalid, valid, or opened for the first 
        time
        {% endcomment %}
        {% if field.help_text %}
            <small class="form-text text-muted">
                {{ field.help_text | safe }}
            </small>
        {% endif %}
    </div>
{% endfor %}